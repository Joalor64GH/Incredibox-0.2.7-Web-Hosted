/* App version : 0.2.7 - Creation date : 2017-12-14 */"use strict";function isEmpty(a){return 0===Object.keys(a).length&&a.constructor===Object}function countObj(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}function existInArray(a,b){for(var c=!1,d=0,e=a.length;d<e;d++)if(a[d]===b){c=!0;break}return c}function numberArray(a){for(var b=0,c=a.length;b<c;b++)a[b]=0|a[b];return a}function windowPopup(a,b,c,d){var e=d?screen.height/2-c/2:0,f=d?screen.width/2-b/2:0;window.open(a,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width="+b+",height="+c+",top="+e+",left="+f)}function networkOn(){hasNetwork=!0}function networkOff(){hasNetwork=!1}function networkState(){return inApp?!(navigator.network.connection.type==Connection.NONE):navigator.onLine}function xhr(a,b,c,d,e){var f=e||function(){};$.ajax({type:a,url:b,crossdomain:!0,data:c,success:function(a){d(a,c)},error:f,dataType:"json"})}function checkFileName(a){var b=checkMiniMobile()?miniFile(a):a;return b}function changeFileName(a,b){var c=a.substr(a.lastIndexOf("."));return a.split(c).join(b+c)}function miniFile(a){var b=a.substr(a.lastIndexOf(".")),c=".svg"!=b?a.split(b).join("-mini"+b):a;return c}function getMobileOperatingSystem(){var a=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(a)?"windows phone":/android/i.test(a)?"android":/iPad/.test(a)&&!window.MSStream?"ipad":/iPhone/.test(a)&&!window.MSStream?"iphone":/iPod/.test(a)&&!window.MSStream?"ipod":"unknown"}function iPadDevice(){return"ipad"==getMobileOperatingSystem()}function iPhoneDevice(){return"iphone"==getMobileOperatingSystem()}function iPodDevice(){return"ipod"==getMobileOperatingSystem()}function iPhone6sAndMore(){var a=device.model.toLowerCase();return a.indexOf("iphone8")>-1||a.indexOf("iphone9")>-1}function loadImg(a,b){function c(){var a=e[g][0],b=e[g][1],c=new Image;c.onload=function(){$(b).css({"background-image":"url("+a+")"}),d()},c.onerror=function(){var b=a.split("/"),c=b[b.length-1];$boxDialog.open("Preloading IMG "+c,"ERROR",["Relaod","Continue"],[gotoUrl,d],!0)},c.src=a}function d(){g++;var a=g==f?b:c;a()}var e="object"!=typeof a[0]?[a]:a,f=e.length,g=0;c()}function loadSnd(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType="arraybuffer",e.onload=function(){b.decodeAudioData(e.response,function(a){c(a)},function(a){d()})},e.onerror=function(){d()},e.send()}function gotoUrl(a){var b=isnull(a)?"index.html":a;window.location.href=b}function openURL(a,b){b=isnull(b)?"_blank":b,b=inApp?"_system":b,window.open(a,b)}function openURLFromIframe(a){window.top.location.href=a}function redirectTo(a){var b="http://www.incredibox.com/url/"+a;if(inApp)switch(a){case"facebook":b=isIOS?"fb://page?id=182619895103489":"fb://page/182619895103489";break;case"twitter":b="https://twitter.com/incredibox_";break;case"instagram":b="https://www.instagram.com/incredibox.official/";break;case"youtube":b="https://www.youtube.com/c/incredibox"}openURL(b)}function getParameterByName(a,b){b||(b=window.location.href),b=b.toLowerCase(),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}function secToText(a){var b=(parseInt(a%1e3/100),parseInt(a/1e3%60)),c=parseInt(a/6e4%60),d=parseInt(a/36e5%24);return d=d<10?"0"+d:d,c=c<10?"0"+c:c,b=b<10?"0"+b:b,c+":"+b}function getTime(){return(new Date).getTime()}function getTimeAgo(a,b){a=a.indexOf("/")==-1?a.split("-").join("/"):a,b=b.indexOf("/")==-1?b.split("-").join("/"):b;var c=new Date(a),d=new Date(b),e=d.getTime()-c.getTime(),f=timeConversion(e);return f===!1?getStringDate(a):f}function timeConversion(a){var b=(a/1e3).toFixed(1),c=(a/6e4).toFixed(1),d=(a/36e5).toFixed(1),e=(a/864e5).toFixed(1),f="";if(b<60){var g=Math.round(b);f=g.toString()+" "+STR(g<2?"txt.tS1":"txt.tS2")}else if(c<60){var h=Math.round(c);f=h.toString()+" "+STR(h<2?"txt.tM1":"txt.tM2")}else if(d<23){var i=Math.round(d);f=i.toString()+" "+STR(i<2?"txt.tH1":"txt.tH2")}else{if(!(e<10))return!1;var j=Math.round(e);f=j.toString()+" "+STR(j<2?"txt.tJ1":"txt.tJ2")}return STR("txt.ago").split("<time>").join(f)}function getDateNow(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();return b=b<10?String("0"+b):String(b),c=c<10?String("0"+c):String(c),e=e<10?e=String("0"+e):String(e),f=f<10?f=String("0"+f):String(f),g=g<10?g=String("0"+g):String(g),String(d+"-"+c+"-"+b+" "+e+":"+f+":"+g)}function jsonDecode(a){if(isnull(a))return null;var b=a.split("\t").join("").split("\n").join("");return JSON.parse(b)}function jsonEncode(a){return isnull(a)?null:JSON.stringify(a)}function random(a){return Math.round(Math.random()*a)}function decimal(a,b){b=isnull(b)?2:b;var c=Math.pow(10,b);return Math.round(a*c)/c}function numberSpaced(a){var b=a.toString(),c=b.indexOf(".");return b.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,function(a,b){return c<0||b<c?a+" ":a})}function trim(a){return isnull(a)?"":a.split("\t").join("").split("\n").join("")}function ucwords(a){return a.charAt(0).toUpperCase()+a.slice(1)}function uniqid(a){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var c=a||"";return b()+c+b()+c+b()+c+b()+c+b()}function getUniqLink(a){var b=notnull(a)?a.app:app.version;return uniqid()+"-v"+b}function isnull(a){return null===a||void 0===a||"undefined"===a}function notnull(a){return null!==a&&void 0!==a&&"undefined"!==a}function transitionEndEventName(){var a,b,c=document.createElement("div"),d={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(d.hasOwnProperty(a)&&c.style[a]!==b)return d[a];return null}function animationEndEventName(){var a,b,c=document.createElement("div"),d={animation:"animationend",OAnimation:"oanimationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(a in d)if(d.hasOwnProperty(a)&&c.style[a]!==b)return d[a];return null}function getCSSMatrix(a){if(!isnull(a)){var b=a.css("-webkit-transform")||a.css("-moz-transform")||a.css("-ms-transform")||a.css("-o-transform")||a.css("transform");return isnull(b)?[1]:b.replace(/[^0-9\-.,]/g,"").split(",")}return[1]}function stopProp(a){a.stopPropagation()}function onResize(){if(screenW=window.innerWidth,screenH=window.innerHeight,appLoaded){for(var a=0;a<nbData;a++)listPicto[a].setPosition();for(a=0;a<app.nbpolo;a++)listPolo[a].setPosition()}}function checkResize(a){var b=$("#app-incredibox"),c=!isnull(a)&&a;screenW=inApp?screen.width:window.innerWidth,screenH=inApp?screen.height:window.innerHeight,screenW=inApp&&isIOS?screen.height:screenW,screenH=inApp&&isIOS?screen.width:screenH;var d=!inApp;if(inApp||($(window).resize(onResize),d=!0,emulate.test("LGH870"),$("#debugframe").width(screenW).height(screenH)),inApp||d){var e=Number((screenW/screenH).toFixed(1));if(e>1.3){var e=screenH/templateH,f=templateH,g=Math.round(screenW/e);stageScale=Number(e.toFixed(3)),b.width(g),b.height(f),b.css({transform:"scale("+stageScale+")"})}else b.width(screenW),b.height(screenH),c=!1}if(c){poloScale=1.15,$("#box-stage").css({transform:"scale("+poloScale+")","transform-origin":"center bottom"}),$("#box-loader").css({transform:"scale("+poloScale+")","transform-origin":"center top"}),$("#stage-overflow").css({height:Math.floor(400/poloScale)+"px"}),pictoScale=1.15,$("#box-picto").css({transform:"scale("+pictoScale+")"});var h=1e3,i=400,j=screenW,k=j*i/h,l=116*e+k,m=(f-116)*e,n=l/e-(f-252);n>m/e-(f-252)&&(n=m/e-(f-252)),n=Math.floor(n),$("#box-video").css({bottom:n*e+"px"}),$("#fade-video").css({bottom:n*e+"px"});var o="<style type='text/css'>";o+="#game #box-bottom.bottomSlide{ transform:translate3d(0px,"+n+"px,0px);}",o+="</style>",$(o).appendTo("head")}if(checkMobile()){$("body").addClass("mobile");var p=f/1.3-20;$("#poplist").css({height:p+"px"})}return checkMiniMobile()&&$("img").each(function(a){var b=$(this).attr("src");$(this).attr("src",miniFile(b))}),this}function checkSystem(){var a=device.platform.toLowerCase();isIOS="ios"==a,isAndroid="android"==a,isiPod=device.model.indexOf("iPod")!=-1,isiPhone=device.model.indexOf("iPhone")!=-1,isiPhone4s=isiPhone&&device.model.indexOf("iPhone4,1")!=-1,isiPad=device.model.indexOf("iPad")!=-1,isiPadPro=isiPad&&device.model.indexOf("6,")!=-1,isiPhone6s=isiPhone&&device.model.indexOf("iPhone8,")!=-1&&device.model.indexOf("iPhone8,4")==-1,device.modelname=phoneModel.get(device.model),isMobile=checkMobile()}function checkInApp(){var a=document.URL;return a.indexOf("http://")===-1&&a.indexOf("https://")===-1}function checkOnDevice(){return!!navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/)}function checkTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function checkMobile(){return screenW=isnull(screenW)?screen.width:screenW,screenH=isnull(screenH)?screen.height:screenH,screenW<=768&&screenH<=432}function checkMiniMobile(){return screenW<=568}function checkSupported(){var a=!!window.HTMLCanvasElement,b=window.AudioContext||window.webkitAudioContext||!1,c="string"==typeof(new XMLHttpRequest).responseType,d=!isnull(transitionEnd)&&!isnull(animationEnd);return window.AudioContext=b,a?b?c?d?"ok":"CSS3 is not supported":"XHR is not supported":"Audio API is not supported":"Canvas is not supported"}function bugBluetoothLatency(){return!notnull(getParameterByName("bluetooth"))&&(!!(inApp&&isAndroid&&contextAudio.baseLatency>.2)&&(bluetoothle.initialize(function(a){switch(a.status){case"enabled":bluetoothle.disable();break;case"disabled":$("#fade-all").removeClass(),$boxDialog.open(STR("dial.bluetoothLatencyText"),STR("dial.bluetoothLatencyTitle"),[STR("bt.ok")],[function(){window.location.href="?v="+appNumberVersion+"&bluetooth=1"}])}},{statusReceiver:!0}),!0))}function bugSampleRate(){return!!(inApp&&isIOS&&contextAudio.sampleRate!=desiredSampleRate&&isnull(getParameterByName("r")))&&(contextAudio.close(),$("body").empty(),window.location.href="?v="+appNumberVersion+"&r=1",!0)}function checkAudioSource(){}function newBoxDialog(a){function b(a){$(a.target).addClass("active");var b=!0;void 0!==a.data.func&&(a.data.func===c&&(b=!1),a.data.func()),b&&c()}function c(){d.close()}var d=$(a);d.cntOpen=0,d.$bck=$(".bac",d),d.$box=$(".box",d),d.$scale=$(".scale",d),d.$pop=$(".pop",d),d.$pop.$title=$(".title",d),d.$pop.$text=$(".text",d),d.$pop.$content=$(".content",d),d.$box.bind(evtPress,stopProp),d.opened=!1;var e=getCSSMatrix(d.$scale);isNaN(parseInt(e[0]))||isnull(e[0])?1:e[0];return d.open=function(a,e,f,g,h){d.opened=!0,a=isnull(a)?"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod":a,e=isnull(e)?"Info":e,f=isnull(f)?["Close"]:f,g=isnull(g)?[c]:g,h=!isnull(h)&&h,d.cntOpen++,d.addClass("show"),d.$bck.fadeIn(),d.$pop.clean(),d.$pop.$title.html(e),d.$pop.$text.html(a);for(var i=0,j=f.length;i<j;i++){g[i];d.$pop.$content.append('<div class="bt bt-mini light" id="bt-mini'+i+'"><div class="txt">'+f[i]+'</div><div class="hitzone"></div></div>'),d.$pop.$content.find("#bt-mini"+i).unbind().bind(evtClick,{func:g[i]},b)}1==d.cntOpen&&d.$box.open(),h&&d.css({"z-index":"9999"})},d.close=function(){d.opened=!1,1==d.cntOpen&&(d.$box.close(),d.$bck.fadeOut()),d.cntOpen--,d.cntOpen<0&&(d.cntOpen=0)},d.$bck.fadeIn=function(a){a?this.addClass("mini"):this.removeClass("mini"),this.addClass("animateFadeIn")},d.$bck.fadeOut=function(){this.addClass("animateFadeOut").one(animationEnd,function(a){$(a.target).removeClass("animateFadeIn animateFadeOut")})},d.$box.open=function(){this.removeClass("open close").addClass("open")},d.$box.close=function(){this.find(".bt-mini").unbind(),this.removeClass("open").addClass("close").one(animationEnd,function(a){0==d.cntOpen&&($(a.target).removeClass("close"),d.removeClass("show"))})},d.$pop.clean=function(){this.$content.find(".bt-mini").unbind(),this.$content.empty()},d}function newPopup(a){function b(a,b){h&&(a.id==m&&b!==!0||(a.addClass("active"),a.$mypop.addClass("active"),isnull(l)||a.id==m||(l.removeClass("active"),l.$mypop.removeClass("active"),d()),l=a,m=a.id))}function c(){h&&b(i[0],0,!0)}function d(){if(h){var a=$boxPoptab.onCloseFunc[l.$mypop.attr("id")];isnull(a)||a()}else isnull(g.funcOnClose)||(g.funcOnClose(),g.funcOnClose=null)}function e(a){var b=!1,c=isTouchDevice?a.originalEvent.targetTouches[0]:a,d=Math.round(c.pageY);h?d>100*stageScale&&(b=!0):b=!0,b&&($body.unbind(evtPress,e),g.close())}function f(){""!=k.type&&g.$pop.addClass(k.type),"mini"==k.bck&&g.addClass(k.bck)}var g=$(a);g.$bck=$(".bac",g),g.$box=$(".box",g),g.$scale=$(".scale",g),g.$poplist=$(".box .pop",g),g.$boxtab=$(".box .box-tab",g),g.$pop=g.$poplist,g.$box.bind(evtPress,stopProp),g.opened=!1;var h=!isnull(g.$boxtab[0]),i=[],j=getCSSMatrix(g.$scale),k=(isNaN(parseInt(j[0]))||isnull(j[0])?1:j[0],{});g.open=function(a){g.opened=!0,k=isnull(a)?{type:"",bck:"",unlock:!1,lockCenter:!1}:a,f(),this.addClass("show"),this.$bck.fadeIn(),this.$box.open(),c()},g.close=function(){g.opened=!1,"action"==k.type&&this.$pop.$icon.unbind(),this.$bck.unbind(),this.$box.close(),this.$bck.fadeOut()},g.$box.open=function(a){isnull(a)||(k=a,f()),this.addClass("slideUp").one(animationEnd,function(a){"action"==k.type?g.$pop.$icon.bind(evtClick,function(){g.close()}):$body.bind(evtPress,e),k.unlock&&unlock()})},g.$box.close=function(a){this.removeClass("slideUp").addClass("slideDown").one(animationEnd,function(b){$(b.target).removeClass("slideDown"),d(),isnull(a)||a()})},g.$bck.fadeIn=function(){this.addClass("animateFadeIn")},g.$bck.fadeOut=function(){this.addClass("animateFadeOut").one(animationEnd,function(a){g.removeClass("show"),g.removeClass(k.bck),$(a.target).removeClass("animateFadeIn animateFadeOut")})};var l=null,m=-1;return h&&$(".tab",g.$boxtab).each(function(a){var c=$(this);i.push(c),c.id=a,c.$mypop=g.$box.find(".pop").eq(a),c.bind(evtClick,function(a){b(c)})}),g}function initFuncPoptab(){$boxPoptab.onCloseFunc={"pop-tuto":function(){a.reinit()}};var a=$boxPoptab.find("#pop-tuto .slideshow");a.$box=$boxPoptab.find("#pop-tuto .slideshow .img-box"),a.$nav=$boxPoptab.find("#pop-tuto .slideshow .nav-box"),a.$btL=$boxPoptab.find("#pop-tuto .bt").first(),a.$btR=$boxPoptab.find("#pop-tuto .bt").last();var b=Math.floor(3*screenW/templateW);b<0&&(b=1),a.init=function(){for(var a=this,c=0,d=0,e=0,f=0,g=this.width(),h=this.find("img").length,i=0;i<h;i++)a.$nav.append('<div class="pt"></div>');this.onPress=function(b){$body.unbind(evtPressEnd,a.onRelease),a.$box.unbind(evtMove,a.onMove),b=isTouchDevice?b.originalEvent.touches[0]:b,c=b.pageX,a.$box.bind(evtMove,a.onMove),$body.bind(evtPressEnd,a.onRelease)},this.onMove=function(e){e=isTouchDevice?e.originalEvent.touches[0]:e,d=Math.round(c-e.pageX)*-1,a.$box.css({transform:"translateX("+(f+d/b)+"px)"})},this.onRelease=function(){$body.unbind(evtPressEnd,a.onRelease),a.$box.unbind(evtMove,a.onMove),d<-100?e!=h-1?a.slide("left"):a.slide():d>100&&0!==e?a.slide("right"):a.slide(),c=0,d=0},this.slide=function(b){$body.unbind(evtPressEnd,a.onRelease),a.$box.unbind(evtMove,a.onMove),a.$box.addClass("slide"),"left"===b?e++:"right"===b&&e--,f=-(g*e),a.$box.css({transform:"translateX("+String(f)+"px)"}),a.light()},this.clickLeft=function(){0!==e&&a.slide("right")},this.clickRight=function(){e!=h-1&&a.slide("left")},this.light=function(){a.$nav.find(".pt").removeClass("active"),a.$nav.find(".pt").eq(e).addClass("active"),a.$btL.removeClass("disable"),a.$btR.removeClass("disable"),0===e&&a.$btL.addClass("disable"),e==h-1&&a.$btR.addClass("disable")},this.reinit=function(){c=d=e=f=0,a.slide()},a.$box.bind(evtPress,a.onPress),this.light(),this.$btL.bind(evtClick,this.clickLeft),this.$btR.bind(evtClick,this.clickRight)},a.init()}function initFuncPopup(a){var b=a;b.$pop.$title=b.$pop.find(".title"),b.$pop.$text=b.$pop.find(".text"),b.$pop.$content=b.$pop.find(".content"),b.$pop.$icon=b.$pop.find(".icon"),b.$pop.clean=function(){this.removeClass("info"),this.removeClass("action"),this.removeClass("open"),this.removeClass("close"),this.$icon.unbind(),this.$content.find(".bt").unbind(),this.$content.empty(),this.$title.empty(),this.$text.empty()},b.$pop.reflow=function(){this.$title.is(":empty")?this.$title.hide():this.$title.show(),this.$text.is(":empty")?this.$text.hide():this.$text.show(),this.$content.is(":empty")?this.$content.hide():this.$content.show()}}function changeDomTxt(){var a=translateObj.trad;if($("#home .bt#home-bt-switch .txt").html(a.bt.version),$("#home .bt#home-bt-list .txt").html(a.bt.mixList),$("#mixlist .tab#tab-mymix").html(a.bt.myMix),$("#mixlist .tab#tab-top50").html(a.bt.top50),$("#mixlist .tab#tab-latest").html(a.bt.latest),$("#mixlist .tab-filter #bt-week .txt").html(a.bt.week),$("#mixlist .tab-filter #bt-month .txt").html(a.bt.month),$("#mixlist .tab-filter #bt-all .txt").html(a.bt.all),$("#mixlist .scroll:not(#list-mymix) .infoListmix").html(a.txt.top50Info),$("#mixlist #list-latest .boxinfo").html(a.txt.top50Info),$("#mixlist #list-week .boxinfo").html(a.txt.top50Info),$("#mixlist #list-month .boxinfo").html(a.txt.top50Info),$("#mixlist #list-all .boxinfo").html(a.txt.top50Info),$("#mixlist .box-info .offline .linked .txt").html(a.txt.offline),$("#watch-info .linked .txt").html(a.txt.offline),notnull(localMixObject)){var b=STR(0==localMixObject.getAllMixByVersion().length?"txt.mixlistEmpty":"txt.mixlistInfo");$("#list-mymix .boxinfo",$poplist).html(b)}$("#watch-info .linked .txt").html(a.txt.offline),$("#watch-info .date, .box-info .date").each(function(){if($(this).attr("data-date")){var a=$(this).attr("data-date");$(this).html(getStringDate(a))}}),reinitLatestList(),$("#pop-tab .tab#tab-credit").html(a.bt.credit),$("#pop-tab #pop-credit #copy").html(a.txt.copyright),$("#pop-tab #pop-credit #team").html(a.txt.team),$("#pop-tab #pop-credit .title").html(a.txt.stayTuned),$("#pop-tab #pop-credit .bt#contact .msg").html(a.bt.contact),$("#pop-tab .tab#tab-tuto").html(a.bt.tuto),$("#pop-tab .tuto1 .txt").html(a.txt.tuto1),$("#pop-tab .tuto2 .txt").html(a.txt.tuto2),$("#pop-tab .tuto3 .txt").html(a.txt.tuto3),$("#pop-tab .tuto4 .txt").html(a.txt.tuto4),$("#pop-tab .tuto5 .txt").html(a.txt.tuto5),$("#pop-tab .tab#tab-param").html(a.bt.param),$("#pop-tab #pop-param .title#title-lang").html(a.txt.language),$("#pop-tab #pop-param .title#title-comments").html(a.txt.comments),$("#pop-tab #pop-param #bt-rating .msg").html(a.bt.rate),$("#pop-tab .tab#tab-follow").html(a.bt.follow),$("#pop-tab #pop-follow .title#git").html(a.bt.git),$("#pop-tab #pop-follow .title#shop").html(a.txt.visitShop),$("#pop-switch .title").html(a.txt.enjoyVersion)}function loadLanguage(a,b){var c=notnull(b)?b:storage.getItem("user-lang")||"en";$("#pop-param .box-lang .bt-mini#bt-lang-"+c).addClass("active"),"undefined"!=typeof translateObj&&$("body").removeClass("lang-"+translateObj.code.toLowerCase()),$.getScript("./lang/"+c+".js").done(function(b,d){storage.setItem("user-lang",c),icloud.save("user-lang",c),$("body").addClass("lang-"+translateObj.code.toLowerCase()),isnull(a)||a()}).fail(function(a,b,c){return storage.setItem("user-lang","en"),icloud.save("user-lang","en"),$boxDialog.open("Impossible to load language settings. Please reload or force to quit the app then retry.","ERROR",["Reload"],[gotoUrl],!0),!1})}function clickBtLang(a){var b=$(a.currentTarget),c=b.attr("id").split("bt-lang-").join("");b.hasClass("active")||($("#pop-param .box-lang .bt-mini").removeClass("active"),b.addClass("active"),loadLanguage(changeDomTxt,c))}function STR(a){for(var b=a.split("."),c=translateObj.trad,d=0,e=b.length;d<e;d++){var f=b[d];if(!(f in c))return;c=c[f]}return c}function getMixFromCloud(a,b){var c=a,d=b,e=0,f=0,g=!1;for(var h in c)if(h.indexOf("mix-")>-1){e++,g=!1;for(var i in d)if(h==i){g=!0;break}if(!g){f++;var j=jsonDecode(c[h]);j.mymix=!0,j.link=isnull(j.link)?getUniqLink(j):j.link,h.indexOf("-IOSV")==-1&&h.indexOf("-v")==-1?(icloud.remove(h),localMixObject.saveMix(j)):localMixObject.saveMix(j,!1)}}}function deleteLocalMix(a,b){var c=a,d=b,e=0,f=!1;for(var g in d){f=!1;for(var h in c)if(g==h){f=!0;break}f||(e++,localMixObject.deleteMix(g))}}function sendMixInCloud(a){var b=a;for(var c in b)icloud.save(c,b[c])}function estimateSpeed(){}function onDeviceReady(){if(cleanOldLocalMix(),inApp){if(notnull(storage.getItem("user"))){var a=jsonDecode(storage.getItem("user")),b=""!=a.alias?a.alias:a.djname;""!=a.alias&&storage.setItem("user-djname-gc",a.alias),storage.setItem("user-djname",b),storage.removeItem("user")}if(notnull(storage.getItem("language"))){var c=storage.getItem("language");storage.removeItem("language"),storage.setItem("user-lang",c)}checkSystem(),forcePlaySound(),isIOS?icloud.sync():isAndroid&&document.addEventListener("backbutton",function(a){a.preventDefault(),navigator.app.exitApp()},!1)}evtClick=isTouchDevice?"touchstart":"click",evtPress=isTouchDevice?"touchstart":"mousedown",evtPressEnd=isTouchDevice?"touchend":"mouseup",evtMove=isTouchDevice?"touchmove":"mousemove";var d=inApp?document:window;d.addEventListener("online",networkOn,!1),d.addEventListener("offline",networkOff,!1),hasNetwork=networkState(),transitionEnd=transitionEndEventName(),animationEnd=animationEndEventName(),checkForMaj(function(){$(document).ready(function(){checkResize(),$("#fade-all").addClass("animateOut").one(animationEnd,function(){$("#fade-all").removeClass("animateOut show white"),$boxDialog=newBoxDialog("#pop-dialog"),"ok"==checkSupported()?loadLanguage(function(){forceMaj?$boxDialog.open(STR("pop.majText"),STR("pop.majTitle"),[STR("bt.update")],[function(){openURL(isAndroid?appAndroid.url:appIOS.url)}],!0):checkRatingModul(function(){setTimeout(launchAnimation,2e3)})}):$boxDialog.open(checkSupported(),"ERROR",[],[],!0)})})})}function launchAnimation(){$("#page-splash #sp-text").html(STR("txt.useHeadphones")),$("#page-splash #sp-title").addClass("tweenUp"),$("#page-splash #sp-baseline").addClass("tweenUp"),$("#page-splash #sp-headphone").addClass("tweenUp"),$("#page-splash #sp-text").addClass("tweenUp"),setTimeout(function(){$("#page-splash #sp-headphone").addClass("tweenDown"),$("#page-splash #sp-text").addClass("tweenDown").one(animationEnd,function(){$("#page-splash #sp-text").html(STR("txt.selectVersion")),$("#page-splash #sp-text").removeClass().addClass("tweenUpDirect"),$("#page-splash #sp-select .icon").addClass("tweenUp"),$("#page-splash #sp-select .icon").bind(evtClick,function(a){var b=$(this).attr("id").split("icon").join("");$("#lock-all").addClass("show"),$(this).find(".bul").addClass("open").one(animationEnd,function(){$("#fade-all").addClass("animateIn").one(animationEnd,function(){window.location.href="app.html?v="+b})})})})},3200)}function checkRatingModul(a){function b(b){1==b?storage.setItem(f,"false:0"):2==b?storage.removeItem(f):(storage.removeItem(f),openURL(isIOS?appIOS.url:appAndroid.url)),a()}if(inApp&&hasNetwork){var c,d=0,e=5,f="ratemsg",g=!1;if(isnull(storage.getItem(f))&&storage.setItem(f,"true:0"),c=storage.getItem(f),!isnull(c)){var h=String(c).split(":"),i=Boolean("true"==h[0]);d=Number(h[1]),i&&(d++,d>=e?(g=!0,$boxDialog.open(STR("pop.rateText"),STR("pop.rateTitle"),[STR("bt.nope"),STR("bt.later"),STR("bt.sure")],[function(){b(1)},function(){b(2)},function(){b(3)}])):storage.setItem(f,"true:"+String(d)))}g||a()}else a()}function checkForMaj(a){var b=setTimeout(a,2e3),c=isIOS?appIOS.version:isAndroid?appAndroid.version:"9.9.9",d=isIOS?"ios":isAndroid?"and":"web";xhr("POST","http://www.incredibox.com/php/ios-check-maj.php?os="+d,{},function(d){if(clearTimeout(b),notnull(d.lastversion)){var e=parseInt(d.lastversion.split(".").join("")),f=parseInt(c.split(".").join(""));f<e&&(forceMaj=!0)}a()},function(){clearTimeout(b),a()})}function forcePlaySound(){if(isAndroid){var a=new window.AudioContext||window.webkitAudioContext;loadSnd("snd/soundtest.mp3",a,function(b){var c=new SoundObject(a);c.prepare(b,0),c.play()},function(){})}}function cleanOldLocalMix(){var a=localStorage.getItem("localmix");if(notnull(a)){var a=jsonDecode(a);for(var b in a)for(var c in a[b]){var d=a[b][c],e=!0;isnull(d.link)&&isnull(d.appv)&&(e=!1),isnull(d.link)&&notnull(d.appv)&&(d.link=getUniqLink(),d.online=!1),e&&localMixObject.saveMix(a[b][c])}localStorage.removeItem("localmix")}}var debugMute=notnull(getParameterByName("mute")),debugGame=notnull(getParameterByName("game")),screenW,screenH,templateW=1024,templateH=768,stageScale=1,pictoScale=1,poloScale=1,emulate={device:{iPhone4:{width:480,height:320},iPhone5:{width:568,height:320},iPhone6:{width:667,height:375},iPhone6s:{width:736,height:414},iPad:{width:1024,height:768},iPadPro:{width:1366,height:1024},GalaxyTab:{width:1280,height:800},GalaxyTab2:{width:1024,height:600},Nexus7:{width:960,height:600},Nexus7:{width:1024,height:500},LGH870:{width:720,height:360}},get:function(a){return this.device[a]},test:function(a){var b=this.get(a||"iPhone6s");screenW=b.width,screenH=b.height}},phoneModel={model:{"iPhone1,1":"iPhone","iPhone1,2":"iPhone 3G","iPhone2,1":"iPhone 3GS","iPhone3,1":"iPhone 4 (GSM)","iPhone3,3":"iPhone 4 (CDMA)","iPhone4,1":"iPhone 4S","iPhone5,1":"iPhone 5 (A1428)","iPhone5,2":"iPhone 5 (A1429)","iPhone5,3":"iPhone 5c (A1456/A1532)","iPhone5,4":"iPhone 5c (A1507/A1516/A1529)","iPhone6,1":"iPhone 5s (A1433/A1453)","iPhone6,2":"iPhone 5s (A1457/A1518/A1530)","iPhone7,1":"iPhone 6 Plus","iPhone7,2":"iPhone 6","iPhone8,1":"iPhone 6s","iPhone8,2":"iPhone 6s Plus","iPhone8,4":"iPhone SE","iPhone9,1":"iPhone 7 (A1660/A1779/A1780)","iPhone9,2":"iPhone 7 Plus (A1661/A1785/A1786)","iPhone9,3":"iPhone 7 (A1778)","iPhone9,4":"iPhone 7 Plus (A1784)","iPad1,1":"iPad","iPad2,1":"iPad 2 (Wi-Fi)","iPad2,2":"iPad 2 (GSM)","iPad2,3":"iPad 2 (CDMA)","iPad2,4":"iPad 2 (Wi-Fi, revised)","iPad2,5":"iPad mini (Wi-Fi)","iPad2,6":"iPad mini (A1454)","iPad2,7":"iPad mini (A1455)","iPad3,1":"iPad (3rd gen, Wi-Fi)","iPad3,2":"iPad (3rd gen, Wi-Fi+LTE Verizon)","iPad3,3":"iPad (3rd gen, Wi-Fi+LTE AT&T)","iPad3,4":"iPad (4th gen, Wi-Fi)","iPad3,5":"iPad (4th gen, A1459)","iPad3,6":"iPad (4th gen, A1460)","iPad4,1":"iPad Air (Wi-Fi)","iPad4,2":"iPad Air (Wi-Fi+LTE)","iPad4,3":"iPad Air (Rev)","iPad4,4":"iPad mini 2 (Wi-Fi)","iPad4,5":"iPad mini 2 (Wi-Fi+LTE)","iPad4,6":"iPad mini 2 (Rev)","iPad4,7":"iPad mini 3 (Wi-Fi)","iPad4,8":"iPad mini 3 (A1600)","iPad4,9":"iPad mini 3 (A1601)","iPad5,1":"iPad mini 4 (Wi-Fi)","iPad5,2":"iPad mini 4 (Wi-Fi+LTE)","iPad5,3":"iPad Air 2 (Wi-Fi)","iPad5,4":"iPad Air 2 (Wi-Fi+LTE)","iPad6,3":"iPad Pro (9.7 inch) (Wi-Fi)","iPad6,4":"iPad Pro (9.7 inch) (Wi-Fi+LTE)","iPad6,7":"iPad Pro (12.9 inch, Wi-Fi)","iPad6,8":"iPad Pro (12.9 inch, Wi-Fi+LTE)","iPad6,11":"iPad 9.7-Inch 5th Gen (Wi-Fi Only)","iPad6,12":"iPad 9.7-Inch 5th Gen (Wi-Fi/Cellular)","iPod1,1":"iPod touch","iPod2,1":"iPod touch (2nd gen)","iPod3,1":"iPod touch (3rd gen)","iPod4,1":"iPod touch (4th gen)","iPod5,1":"iPod touch (5th gen)","iPod7,1":"iPod touch (6th gen)"},get:function(a){var b=this.model[a];return isnull(b)?a:b}},CloudSync=function(){function a(a){if(isnull(a["player-id"])){var b=uniqid("-");e.save("player-id",b),storage.setItem("player-id",b)}else f=!1,storage.setItem("player-id",a["player-id"]);notnull(storage.getItem("user-djname-gc"))?(e.save("user-djname",storage.getItem("user-djname")),storage.remove("user-djname-gc")):notnull(a["user-djname"])?storage.setItem("user-djname",a["user-djname"]):notnull(storage.getItem("user-djname"))&&e.save("user-djname",storage.getItem("user-djname")),notnull(a["user-lang"])?storage.setItem("user-lang",a["user-lang"]):notnull(storage.getItem("user-lang"))&&e.save("user-lang",storage.getItem("user-lang"));var c=storage.getAllItem(),d={};for(var g in c)g.indexOf("mix-")!=-1&&(d[g]=jsonDecode(c[g]));f?sendMixInCloud(d):(getMixFromCloud(a,d),deleteLocalMix(a,d))}function b(a){}function c(a){}function d(){}var e=this,f=!0;return this.sync=function(){iCloudKV.sync(a,b)},this.save=function(a,b){inApp&&isIOS&&(b="string"!=typeof b?jsonEncode(b):b,iCloudKV.save(a,b,function(){}))},this.load=function(a){iCloudKV.load(a,c,d)},this.remove=function(a){inApp&&isIOS&&iCloudKV.remove(a,function(){})},this.clear=function(a){for(var b in a)e.remove(b)},this},LocalStorage=function(){return this.setItem=function(a,b){window.localStorage.setItem(a,b)},this.getItem=function(a){return window.localStorage.getItem(a)},this.getAllItem=function(){return window.localStorage},this.removeItem=function(a){window.localStorage.removeItem(a)},this.clear=function(){window.localStorage.clear()},this.weight=function(){var a,b,c=window.localStorage,d=0,e="LS | --------------------------\n";for(b in c)a=2*(c[b].length+b.length),d+=a,e+="LS | "+b.substr(0,50)+" = "+(a/1024).toFixed(2)+" KB\n";return e+="LS | Total = "+(d/1024).toFixed(2)+" KB\n",e+="LS | --------------------------"},this},LocalMixObject=function(){var a=this;this.mixlist=[],this.saveMix=function(a,b){var c=b||!0;if(notnull(a)){delete a.addColor,delete a.intop50;var d=a.link.indexOf("mix-")==-1?"mix-"+a.link:a.link,e=jsonEncode(a);return storage.setItem(d,e),c&&icloud.save(d,e),!0}return!1},this.deleteMix=function(a){var b=a.indexOf("mix-")==-1?"mix-"+a:a;return!!notnull(storage.getItem(b))&&(storage.removeItem(b),icloud.remove(b),!0)},this.getMix=function(a){return!!notnull(storage.getItem(a))&&jsonDecode(storage.getItem(a))},this.getAllMix=function(a){var b=a||!1,c=[],d=storage.getAllItem();for(var e in d)e.indexOf("mix-")!=-1&&(b?e.indexOf("v"+app.version)==-1&&e.indexOf("-IOSV"+app.version)==-1||c.push(jsonDecode(d[e])):c.push(jsonDecode(d[e])));return c},this.getAllMixByVersion=function(b){var c=a.getAllMix(!0);return c.sort(function(a,b){return b.date>a.date?1:b.date<a.date?-1:0}),b===!0&&(c=c.reverse()),a.mixlist=c,c},this.getLastMix=function(){var a=getAllMixByVersion(),b=a.length;return b>0?a[b-1]:null},this.getLastDjName=function(){var b=a.getLastMix();return notnull(b)?b.name:""},this.getStatMixOnline=function(b){for(var c=a.getAllMix(),d=c.length,e=[],f=[],g=0;g<d;g++){var h=c[g];h.online&&(isnull(h.id)?e.push(h.link):f.push(parseInt(h.id)))}e.length>0||f.length>0?xhr("POST","http://www.incredibox.com/php/ios-get-stat-mix.php",{tablink:jsonEncode(e),tabid:jsonEncode(f)},function(c){if("success"==c.state){XHRmemotime.mymix=new Date;for(var d=0,e=c.list.length;d<e;d++){var f=jsonDecode(c.list[d]),g=a.getMix("mix-"+f.link);g.id=f.id,g.nbview=f.nbview,g.nblike=f.nblike,a.saveMix(g)}void 0!==b&&b()}},function(a){}):void 0!==b&&b()}},PoloObject=function(a,b,c,d,e,f){function g(){var a=random(7)+2;TweenMax.delayedCall(a,i)}function h(){TweenMax.killTweensOf(i)}function i(){qa=getTime();var a=random(ua.length-1);ta=ua[a],ra=ta.length,sa=ra/(36*ra),v.mode("cligne")}function j(){v.mode("normal")}function k(){ba.globalAlpha=1,ba.drawImage(fa,0,0,xa,ya,v.posX,v.posY,va,wa)}function l(a,b){ba.drawImage(fa,a*pa,b*pa,xa,40*pa,v.posX,v.posY+97,va,40)}function m(){ba.globalAlpha=1-ha,ba.drawImage(fa,xa,0,xa,ya,v.posX,v.posY,va,wa)}function n(){k(),l(492,0),m()}function o(){v.updateLoader(),ba.globalAlpha=1,ba.drawImage(M,0,0,Ba,Ca,v.posX,v.posY,za,Aa)}function p(){v.updateLoader(),ba.globalAlpha=1,ba.drawImage(M,0,0,Ba,Ca,v.posX,v.posY,za,Aa),ba.globalAlpha=1-ia,ba.drawImage(M,2*Ba,0,Ba,Ca,v.posX,v.posY,za,Aa)}function q(){R?n():(v.anime(),ba.globalAlpha=1,ba.drawImage(M,Ba,0,Ba,Ca,v.posX,v.posY,za,Aa),ba.drawImage(M,C*pa,D*pa+1,Ba,Math.floor(Q*pa)-1,v.posX+E,v.posY+F+1,za,Q-1))}function r(){var a=timenow-qa,b=Math.floor(a*sa);b=b>ra-1?ra-1:b,k(),l(492,40*ta[b]),m(),b>=ra-1&&j()}function s(){if(V)q();else{k();var a=v.getPupPos(ja,ka),b=v.getPupPos(la,ma);ba.beginPath(),ba.fill(),ba.arc(a[0],a[1],na,0,2*Math.PI,!0),ba.arc(b[0],b[1],na,0,2*Math.PI,!0),ba.closePath(),ba.fill(),mouseY<z+v.posY+50?l(328,120):mouseY>=z+v.posY+50&&mouseY<z+v.posY+100?l(328,80):mouseY>=z+v.posY+180?l(328,40):l(328,0)}}function t(){s(),m()}function u(){s()}this.sound=new SoundObject(c);var v=this,w=$("#polo"+a,b).css({left:e+20+"px",top:f+"px"}),x=$('<div class="zone"><div class="loader"><div class="bar"></div></div><div class="pointer"></div></div>');$("#box-loader").append(x),
x.css({left:e+20+"px"});var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y=$(".loader",x),Z=$(".bar",x),_=$(".pointer",x),aa=a,ba=d,ca="",da="normal",ea=!1,fa=spritePolo,ga=n,ha=.5,ia=.3,ja=61,ka=118,la=102,ma=118,na=7,oa=!1,pa=isiPhone4s?.6:1;this.posX=e,this.posY=400,this.pictoHoverId=null,this.reinit=function(){g(),v.draw(),oa=!1,v.pictoHoverId=null,C=D=E=F=G=H=I=0,ca=J=K=L=M=N=O=P=Q=null,R=S=T=U=V=W=X=!1},this.setPosition=function(){B=screenH-252*stageScale,y=b.offset().left,z=b.offset().top,A={px:w.offset().left,py:w.offset().top,width:w.outerWidth()*stageScale*poloScale,height:w.outerHeight()*stageScale*poloScale}},this.getId=function(){return aa},this.getPicto=function(){return J},this.getAssetId=function(){return K},this.getMoment=function(){return G},this.getLoop=function(){return H},this.getEnabled=function(){return S},this.getBusy=function(){return T},this.getMode=function(){return da},this.getDeleting=function(){return V},this.getPlaying=function(){return U},this.getDiv=function(){return w},this.getMute=function(){return W},this.getSolo=function(){return X},this.setSolo=function(a){X=a},this.setLoop=function(a){H=a},this.setMoment=function(a){G=a},this.setPlaying=function(a){U=a},this.habiller=function(a,b,c,d){v.checkState(),J=a,K=a.getId(),G=b,L=c.imgData,Q=c.headHeight,M=c.imgSprite,ca=c.color,I=L.length,T=!0,Z.css({"background-color":"#"+ca}),_.css({"background-color":"#"+ca}),ea?v.mode("waiting"):(R=!0,TweenMax.delayedCall(d,v.rebond)),recordMix.xmlAction("append",v)},this.checkState=function(){V&&(ea||(TweenMax.killTweensOf(v),v.remonte(0,!0,!1)))},this.deshabiller=function(a,b){V=!0,T=!1;var c=(v.posY,b?0:.3);TweenMax.to(v,c,{posY:400,ease:Quint.easeIn,onComplete:v.remonte,onCompleteParams:[0,!0,b],delay:a,overwrite:!0}),this.hideLoader(!0),recordMix.xmlAction("remove",v)},this.baisser=function(a,b){this.posY=400},this.remonte=function(a,b,c){ea=!0,b===!0&&(J.reactiver(!0),v.reinit(),majListPoloDrop()),v.mode("normal");var d=40+Math.round(60*Math.random()),e=(v.posY,c?0:.4),f=c?0:a;TweenMax.to(v,e,{posY:d,ease:Back.easeOut,delay:f,onComplete:function(){ea=!1},overwrite:!0})},this.rebond=function(a){var b=v.posY,c=b-20,d=U?"anime":"waiting";d=v.getMute()?"mute":d,v.mode(d),TweenMax.to(v,.1,{posY:c,ease:Quint.easeOut,onComplete:v.rebond2,overwrite:!0}),R=!1},this.rebond2=function(){var a=v.posY,b=a+20;TweenMax.to(v,.2,{posY:b,ease:Back.easeOut,overwrite:!0})},this.showLoader=function(){TweenMax.to(Y,.3,{scaleX:1,ease:Quint.easeOut,overwrite:!0})},this.showYou=function(){U&&_.addClass("show").one(animationEnd,function(a){$(a.target).removeClass("show")})},this.hideLoader=function(a){TweenMax.to(Y,.2,{scaleX:0,ease:Quint.easeOut,overwrite:!0})};var qa,ra,sa=0,ta=[],ua=[[0,1,2,2,1,0],[0,3,4,5,6,7,8,0],[0,3,4,4,3,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,1,2,2,2,2,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1,2,2,9,9,9,9,2,2,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,2,2,2,10,10,10,10,10,10,10,10,10,10,1,2,2,10,10,10,10,10,2,2,0]],va=164,wa=400,xa=va*pa,ya=wa*pa,za=164,Aa=380,Ba=za*pa,Ca=Aa*pa;this.mode=function(a){if(a!=da)switch(h(),da=a){case"normal":ga=n,g();break;case"cligne":ga=r;break;case"regarde":ga=t;break;case"hover":ga=u;break;case"waiting":ga=o;break;case"anime":ga=q;break;case"mute":ga=p}},this.draw=function(){ga()},this.updateLoader=function(){Z.css({width:pctMetronome+"%"})},this.anime=function(){var a=frame;boucleA&&I==frameTotal&&(a+=frameHalf),a>=I-1&&(a=I-1),C=L[a][0],D=L[a][1],E=L[a][2],F=L[a][3]},this.getPupPos=function(a,b){var c=(mouseX-y)/stageScale,d=(mouseY-z)/stageScale,e=c/poloScale-a-this.posX,f=d/poloScale-b-this.posY,g=Math.atan2(f,e),h=na*Math.cos(g)+(v.posX+a),i=na*Math.sin(g)+(v.posY+b);return[h,i]},isMixReplay&&(this.activerClick=function(){S=!0},this.desactiverClick=function(){S=!1});var Da,Ea=!1,Fa=!1,Ga=0,Ha=0,Ia=isTouchDevice?60*stageScale:20,Ja=0,Ka=0,La=isTouchDevice?60*stageScale:20;this.activerClick=function(){S=!0,w.bind(evtPress,v.touchStart)},this.desactiverClick=function(){S=!1,clearTimeout(Da),w.unbind(evtPress,v.touchStart),w.unbind(evtMove,v.touchMove),w.unbind(evtPressEnd,v.touchEnd)},this.touchStart=function(a){Ea=Fa=!1;var b=isTouchDevice?a.originalEvent.targetTouches[0]:a;Ga=Ha=b.pageX,Ja=Ka=b.pageY,Da=setTimeout(function(){v.touchLong(a)},250),w.bind(evtMove,v.touchMove),w.bind(evtPressEnd,v.touchEnd)},this.touchMove=function(a){var b=isTouchDevice?a.originalEvent.targetTouches[0]:a;Ha=b.pageX,Ka=b.pageY,Ka>Ja+La&&Math.abs(Ha-Ga)<Ia&&(clearTimeout(Da),clickPolo(v))},this.touchLong=function(a){clearTimeout(Da),X=!0,soloPolo(v)},this.touchEnd=function(a){Ea=!0,clearTimeout(Da),w.unbind(evtMove,v.touchMove),w.unbind(evtPressEnd,v.touchEnd),X?(1==getTotalSolo()?stopSoloPolo():v.mute(),X=!1):v.switchMute()},isMixReplay,this.playSound=function(){U=!0,this.sound.play(0),H++},this.stopSound=function(a){a=!isnull(a)&&a,U=!1,this.sound.stop(a)},this.mute=function(){W=!0,this.mode("mute"),this.sound.mute(),recordMix.xmlAction("mute",v)},this.unmute=function(){W=!1,U?this.mode("anime"):this.mode("waiting"),this.sound.unmute(),recordMix.xmlAction("unmute",v)},this.switchMute=function(){W?v.unmute():v.mute()},this.hitTest=function(a,b){var c=a/stageScale,d=b/stageScale;return c>A.px&&c<A.px+A.width&&d>A.py&&d<B},this.hitTestPicto=function(a){if(!T&&!V){var b=a.getBound();return v.hitTest(Math.round(b.px*stageScale),Math.round(b.py*stageScale))}return!1},this.rollover=function(){oa||(oa=!0,v.mode("hover"))},this.rollout=function(a){var b=!isnull(a)&&a;b?(oa=!1,v.mode("normal")):oa&&(oa=!1,v.mode("regarde"))},this.setPosition(),this.reinit()},PictoObject=function(a,b){var c,d,e,f,g,h=this,i=a,j=$("#picto"+i,b),k=isTouchDevice?j:$body,l=$(".scale",j),m=j.innerWidth(),n=isMobile?1.1:1.2,o=0,p={px:0,py:0};this.getDiv=function(){return j},this.getId=function(){return i},this.getColor=function(){return g},this.use=!1,this.polo=null,this.init=function(a,b){o=-(i*m),j.css({top:b+"px",left:a+"px"}),l.css({"background-position":String(o)+"px 0px"}),h.setPosition()},this.setPosition=function(){f=j.parent().offset().top,e=j.parent().offset().left,c=j.offset().left,d=j.offset().top},this.getBound=function(){return p},isMixReplay&&(this.activer=function(){},this.desactiver=function(){}),this.activer=function(){h.desactiver(),j.bind(evtPress,h.touchStart)},this.desactiver=function(){j.unbind(),k.unbind(evtMove,h.touchMove),k.unbind(evtPressEnd,h.touchEnd)},this.touchStart=function(a){j.unbind(),k.bind(evtMove,h.touchMove),k.bind(evtPressEnd,h.touchEnd);var b=a;a=isTouchDevice?a.originalEvent:a,j.removeClass("flashme"),j.addClass("drag"),h.touchMove(b),pictoOnDrag(h)},this.touchMove=function(a){a=inApp?a.originalEvent:a;var b=isTouchDevice?a.targetTouches[0]:a;h.bouger(b.pageX,b.pageY),a.preventDefault(),pictoOnMove(h)},this.touchEnd=function(){k.unbind(),j.removeClass("drag"),pictoOnDrop(h)},this.bouger=function(a,b){p={px:a,py:b};var e=(a-c)/stageScale,f=(b-d)/stageScale;e-=m/2*pictoScale,f-=m/n*pictoScale,e/=pictoScale,f/=pictoScale,j.css({transform:"translate3d("+e+"px, "+f+"px, 0px)"})},isMixReplay,this.replacer=function(){j.addClass("replacer").one(animationEnd,h.replacerFini)},this.forceReplacer=function(){h.desactiver(),j.removeClass("drag"),j.css({transform:"translate3d(0px ,0px, 0px)"}),l.css({"background-position":String(o)+"px -68px"}),h.reactiver()},this.absorber=function(a){j.css({transform:"translate3d(0px, 0px, 0px)"}),l.css({"background-position":String(o)+"px -68px"}),j.addClass("griser"),j.bind(evtPress,h.showYourPolo),h.use=!0,h.polo=a},this.reactiver=function(a){var b=a||!1;l.css({"background-position":String(o)+"px 0px"}),j.removeClass("griser"),b&&!modeRandom?j.addClass("flashme").one(animationEnd,function(a){$(a.target).removeClass("flashme"),h.replacerFini()}):h.replacerFini()},this.replacerFini=function(){j.removeClass("replacer"),j.css({transform:"translate3d(0px ,0px, 0px)"}),h.use=!1,h.activer()},this.showYourPolo=function(){h.polo.showYou()}},BonusObject=function(a,b,c,d){var e=this,f=b,g=a+1,h=$("#bt-bonus-"+g),i=$(".eye",h),j=$(".circle",h),k=$("#box-video .video#video"+g),l=$("#box-video .video#video"+g+" video"),m=l[0],n=!1,o=new ClockObject("canvas-bt-bonus-"+g),p=new SoundObject(c),q=d,r=numberArray(f.code.split(",")),s=r.length,t=0,u=[];this.video=m,l.bind("ended",e.videoEnded),o.init(60,60,1,52,16,"#8C8C8C"),this.unlock=!1;for(var v=0;v<s;v++){var w={obj:$(".svg.q"+(v+1),h),col:$(".svg.q"+(v+1)+" svg",h).css("fill")};u.push(w)}this.getId=function(){return g-1},this.hasCode=function(a){for(var b=0;b<s;b++)if(a==r[b])return!0;return!1},this.checkCode=function(a,b){for(var c=0;c<s;c++)a==r[c]&&(b?e.showQuarter(c):e.hideQuarter(c))},this.showQuarter=function(a){t++;var b=u[a].obj,c=u[a].col;t==s?(modeReplay||b.removeClass("hide").addClass("directshow"),e.showEye()):modeReplay||(j.addClass("show").one(animationEnd,function(a){$(a.target).removeClass("show")}),j.css({"border-color":c}),b.removeClass("hide").addClass("directshow show"))},this.hideQuarter=function(a){if(!modeReplay){var b=u[a].obj;b.addClass("hide").one(animationEnd,function(a){$(a.target).removeClass("directshow show hide")})}t==s&&(cancelClickBtBonus(),this.hideEye()),t--,t<0&&(t=0)},this.hideClock=function(){o.stop(!0)},this.render=function(a){o.render()},this.showEye=function(){modeReplay||i.addClass("bounce"),e.unlock=!0},this.reduceEye=function(){modeReplay||i.addClass("reduce")},this.hideEye=function(){modeReplay||i.addClass("hide").one(animationEnd,function(a){$(a.target).removeClass("bounce reduce hide")}),e.unlock=!1,e.hideClock()},this.touchStart=function(a){e.unlock?(e.click(),recordMix.xmlAction("bonus",e)):loopOn&&poloShowPointer(g)},this.click=function(){getRemainingTime()<500&&boucleA||(clickBtBonus(g),e.unlock=!1,e.reduceEye(),j.addClass("showCircle").one(animationEnd,function(a){$(a.target).removeClass("showCircle")}),l.bind("timeupdate",e.timeUpdated),m.currentTime=0,m.play(),p.prepare(q),o.start(getRemainingTime(!boucleA),!0))},this.timeUpdated=function(){m.currentTime=0},this.play=function(){l.unbind("timeupdate",e.timeUpdated),o.start(loopDuration*app.nbloopbonus,!1),n=!0,p.play(0),k.addClass("show")},this.stop=function(){l.unbind("timeupdate",e.timeUpdated),m.pause(),n&&(p.stop(),o.stop(!0)),t==s&&e.showEye(),n=!1,k.removeClass("show")},this.videoEnded=function(){},this.pause=function(){n&&(m.pause(),p.pause()),o.pause()},this.resume=function(){n&&(m.play(),p.unpause()),o.resume()},this.enable=function(){h.bind(evtPress,e.touchStart)},this.disable=function(){h.unbind(evtPress,e.touchStart)},this.enable()},SoundObject=function(a){var b,c,d,e,f,g,h,i,j=this,k=a,l=!1,m=!1;this.getMute=function(){return l},this.prepare=function(a,g){d=a,f=0==g?0:1,f=debugMute?0:f,b=k.createBufferSource(),b.buffer=d,e=d.duration,c=k.createGain(),c.gain.value=f,b.connect(c),c.connect(k.destination)},this.getDuration=function(){return null!=d?d.duration:0},this.getCurrentTime=function(){return null!=b?b.context.currentTime:0},this.play=function(a,c){h=getTime(),c>0?b.start(0,a):b.start(0,a),l&&this.mute()},this.stop=function(a){null!=b&&(b.onended=null,b.context.currentTime>0&&j.fade(a))},this.fade=function(a){if(null!=b)if(l)j.stopSource();else var d=a?.03:.3,e=f,g=setInterval(function(){e-=d,null!=c&&(c.gain.value=e),e<=0&&(e=0,clearInterval(g),j.stopSource())},5)},this.stopSource=function(){null!=b&&(isIOS&&iosVersionNumber<103?b.noteOff(0):b.stop(0)),b=null,c=null,m||(l=!1,g=null,h=0,i=0)},this.pause=function(a){m=!0,i=getTime()-h,i<0?i=0:i,this.stop(a)},this.unpause=function(a){m=!1,this.prepare(d,f),null!=b&&(a===!0?(this.play(i/1e3,(loopDuration-i)/1e3),this.loop(g)):this.play(i/1e3),h=getTime()-i)},this.mute=function(){null!=b&&(c.gain.value=0),l=!0},this.unmute=function(){null!=b&&(c.gain.value=1),l=!1},this.loop=function(a){b.onended=a,g=a};this.checkSoundCanPlay=function(a,b){return b(),!1}},ClockObject=function(a){var b,c,d,e,f,g,h,i,c,j,k,l,m,n=$("#"+a),o=n[0],p=o.getContext("2d"),q=2*Math.PI,r=Math.PI/2,s=!1,t=!1,u=0;this.start=function(a,b){s=!0,t=!1,m=b,k=a,l=100/k,j=getTime()},this.stop=function(a){s=!1,a?p.clearRect(d-g-h/2,e-g-h/2,2*g+h,2*g+h):(t=!0,b=m?0:1)},this.pause=function(){u=getTime()},this.resume=function(){var a=getTime()-u;j+=a},this.render=function(){if(s||t){if(s){var a=getTime()-j;c=a*l/100}else t&&(c+=.2*(b-c));c<.001?c=.001:c,c>.999?c=.999:c;var f=m?-r:q*c-r,i=m?q*c-r:-r;p.clearRect(d-g-h/2,e-g-h/2,2*g+h,2*g+h),p.beginPath(),p.arc(d,e,g,f,i,!1),p.stroke(),t&&(.001!=c&&.999!=c||(t=!1,p.clearRect(d-g-h/2,e-g-h/2,2*g+h,2*g+h)))}};var v=!1;this.checkAtEnd=function(){v=!0},this.init=function(a,b,c,j,k,l){d=void 0==a?0:a,e=void 0==b?0:b,f=void 0==c?1:c,g=void 0==j?18:j,h=void 0==k?6:k,i=void 0==l?"#FFFFFF":l,p.lineWidth=h,p.strokeStyle=i,p.globalAlpha=f}},ReadingBar=function(a,b,c){var d,e=this,f=$(a),g=$("#reading-buffer",f),h=$cntRecord.find("#t-spent"),i=$cntRecord.find("#t-duration"),j=!1,k=0,l="#D20A0A",m="#36B460",n="record",o=secToText(app.looptime*app.recmaxloop);this.minLoop=b,this.maxLoop=c,this.maxTime=0,this.cntLoop=0,this.isFinished=function(){return this.cntLoop==this.maxLoop},this.isLastLoop=function(){return this.cntLoop+1==this.maxLoop},this.open=function(a){return n=a,e.createRecordBlock(),e.cntLoop=0,e.maxTime="record"==n?o:secToText(e.maxLoop*app.looptime),g.css({transform:"scale(0)"}),h.text("00:00"),i.text(" / "+e.maxTime),TweenMax.to(f,.4,{top:"0px",ease:Quint.easeOut}),TweenMax.to($cntRecord,.4,{opacity:1,display:"block",ease:Quint.easeOut,delay:"record"==n?.4:0}),e},this.close=function(){return TweenMax.to(f,.4,{top:"-10px",ease:Quint.easeIn}),TweenMax.to($cntRecord,.3,{opacity:0,display:"none",ease:Quint.easeOut}),e},this.start=function(){return j=!0,e.cntLoop=0,k=0,"record"==n?recordMix.start():replayMix.start(),e},this.stop=function(){return j=!1,"record"==n?recordMix.stop():replayMix.stop(),e},this.loop=function(){return e.cntLoop++,k+=d,e.isFinished()?"record"==n?stopRecordMode():stopReplayMode():"record"==n?recordMix.loop():replayMix.loop(),e},this.render=function(){if(j){d=pctMetronome;var a=Math.floor(k+d)/e.maxLoop;h.text(secToText(getTimeSpent()+loopDuration*e.cntLoop)),g.css({transform:"scale("+a/100+", 1)"})}},this.createRecordBlock=function(){var a="record"==n?l:m,b="record"==n?decimal(e.minLoop/e.maxLoop,2):0;$("#reading-block",f).css({transform:"scale("+b+", 1)"}),$($cntRecord).css({color:a}),g.css({"background-color":a})},this.createRecordBlock()},RenderRAF=function(a,b){function c(){f=0,g=1e3/l,j=Date.now(),h=j,d()}function d(){return!n&&(e=requestAnimationFrame(d),i=Date.now(),k=i-j,void(k>g&&(j=i-k%g,m())))}var e,f,g,h,i,j,k,l=a||-1,m=b||function(){},n=!1;this.start=function(a){l=a||l,n=!1,c()},this.stop=function(){n=!0,cancelAnimationFrame(e)}},forceMaj=!1,inApp=checkInApp(),isDevice=inApp||checkOnDevice(),isTouchDevice=checkTouchDevice(),isMobile=!1,isIOS=!1,isAndroid=!1,isiPod=!1,isiPhone=!1,isiPhone4s=!1,isiPhone6s=!1,isiPad=!1,isiPadPro=!1,appLoaded=!1,hasNetwork=!1,storage=new LocalStorage,icloud=new CloudSync,localMixObject=new LocalMixObject,evtClick,evtPress,evtPressEnd,evtMove,transitionEnd,animationEnd,$boxDialog;document.addEventListener(inApp?"deviceready":"DOMContentLoaded",onDeviceReady,!1);